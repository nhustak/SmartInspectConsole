<Window x:Class="SmartInspectConsole.Views.EditViewDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SmartInspectConsole.Views"
        mc:Ignorable="d"
        Title="Edit View"
        Height="680" Width="520"
        MinHeight="500" MinWidth="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        ShowInTaskbar="False"
        Background="{DynamicResource BackgroundBrush}"
        Foreground="{DynamicResource ForegroundBrush}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>

        <!-- Converter for showing tag panel only when items exist -->
        <local:CountToVisibilityConverter x:Key="CountToVisibility"/>

        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="Padding" Value="0,4"/>
        </Style>
        <Style TargetType="GroupBox">
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="Padding" Value="8"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="Padding" Value="16,6"/>
            <Setter Property="Margin" Value="4,0"/>
        </Style>

        <!-- Tag toggle button style -->
        <Style x:Key="TagToggleButton" TargetType="ToggleButton">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1976D2"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#1565C0"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#2196F3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <DockPanel Margin="16">
        <!-- Buttons - docked at bottom so always visible -->
        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="OK" IsDefault="True" Click="OK_Click"/>
            <Button Content="Cancel" IsCancel="True" Click="Cancel_Click"/>
        </StackPanel>

        <!-- Scrollable content area -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel>
                <!-- View Name -->
                <GroupBox Header="View Name">
                    <TextBox Text="{Binding ViewName, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Name displayed on the tab"/>
                </GroupBox>

                <!-- Data Filters -->
                <GroupBox Header="Data Filters">
                    <StackPanel>
                        <!-- Application Filter -->
                        <StackPanel Margin="0,0,0,8">
                            <Label Content="Application:" Padding="0,0,0,4"/>
                            <ItemsControl ItemsSource="{Binding AvailableAppNames}"
                                          Visibility="{Binding AvailableAppNames.Count, Converter={StaticResource CountToVisibility}, FallbackValue=Collapsed}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <ToggleButton Style="{StaticResource TagToggleButton}"
                                                      Content="{Binding Value}"
                                                      IsChecked="{Binding IsSelected}"
                                                      Click="AppTag_Click"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <TextBox Text="{Binding AppFilter, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="Filter by app name. Use comma for multiple values, or click tags above."
                                     Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Session Filter -->
                        <StackPanel Margin="0,0,0,8">
                            <Label Content="Session:" Padding="0,0,0,4"/>
                            <ItemsControl ItemsSource="{Binding AvailableSessions}"
                                          Visibility="{Binding AvailableSessions.Count, Converter={StaticResource CountToVisibility}, FallbackValue=Collapsed}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <ToggleButton Style="{StaticResource TagToggleButton}"
                                                      Content="{Binding Value}"
                                                      IsChecked="{Binding IsSelected}"
                                                      Click="SessionTag_Click"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <TextBox Text="{Binding SessionFilter, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="Filter by session name. Use comma for multiple values, or click tags above."
                                     Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Hostname Filter -->
                        <StackPanel Margin="0,0,0,8">
                            <Label Content="Hostname:" Padding="0,0,0,4"/>
                            <ItemsControl ItemsSource="{Binding AvailableHostnames}"
                                          Visibility="{Binding AvailableHostnames.Count, Converter={StaticResource CountToVisibility}, FallbackValue=Collapsed}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <ToggleButton Style="{StaticResource TagToggleButton}"
                                                      Content="{Binding Value}"
                                                      IsChecked="{Binding IsSelected}"
                                                      Click="HostnameTag_Click"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <TextBox Text="{Binding HostnameFilter, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="Filter by hostname. Use comma for multiple values, or click tags above."
                                     Margin="0,4,0,0"/>
                        </StackPanel>

                        <!-- Process ID and Thread ID (simple text inputs) -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="16"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Label Grid.Column="0" Content="Process ID:"/>
                            <TextBox Grid.Column="1"
                                     Text="{Binding ProcessIdFilter, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="Filter by process ID. Use comma for multiple values"/>

                            <Label Grid.Column="3" Content="Thread ID:"/>
                            <TextBox Grid.Column="4"
                                     Text="{Binding ThreadIdFilter, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="Filter by thread ID. Use comma for multiple values"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <!-- Title Matching -->
                <GroupBox Header="Title Matching">
                    <StackPanel>
                        <CheckBox Content="Enable title matching"
                                  IsChecked="{Binding EnableTitleMatching}"/>

                        <Grid Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Label Grid.Column="0" Content="Pattern:"/>
                            <TextBox Grid.Column="1"
                                     Text="{Binding TitlePattern, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding EnableTitleMatching}"
                                     ToolTip="Pattern to match against log entry titles"/>
                        </Grid>

                        <WrapPanel Margin="0,8,0,0">
                            <CheckBox Content="Case sensitive"
                                      IsChecked="{Binding TitleCaseSensitive}"
                                      IsEnabled="{Binding EnableTitleMatching}"
                                      Margin="0,0,16,0"/>
                            <CheckBox Content="Regular expression"
                                      IsChecked="{Binding TitleIsRegex}"
                                      IsEnabled="{Binding EnableTitleMatching}"
                                      Margin="0,0,16,0"/>
                            <CheckBox Content="Invert match"
                                      IsChecked="{Binding TitleInvert}"
                                      IsEnabled="{Binding EnableTitleMatching}"
                                      ToolTip="Show entries that DON'T match the pattern"/>
                        </WrapPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Log Entry Types -->
                <GroupBox Header="Log Entry Types">
                    <StackPanel>
                        <WrapPanel>
                            <CheckBox Content="Debug" IsChecked="{Binding ShowDebug}" Margin="0,0,16,4"/>
                            <CheckBox Content="Verbose" IsChecked="{Binding ShowVerbose}" Margin="0,0,16,4"/>
                            <CheckBox Content="Message" IsChecked="{Binding ShowMessage}" Margin="0,0,16,4"/>
                            <CheckBox Content="Warning" IsChecked="{Binding ShowWarning}" Margin="0,0,16,4"/>
                            <CheckBox Content="Error" IsChecked="{Binding ShowError}" Margin="0,0,16,4"/>
                            <CheckBox Content="Fatal" IsChecked="{Binding ShowFatal}" Margin="0,0,16,4"/>
                        </WrapPanel>
                        <WrapPanel Margin="0,4,0,0">
                            <CheckBox Content="Enter/Leave Method" IsChecked="{Binding ShowMethodFlow}" Margin="0,0,16,4"/>
                            <CheckBox Content="Separator" IsChecked="{Binding ShowSeparator}" Margin="0,0,16,4"/>
                            <CheckBox Content="Other" IsChecked="{Binding ShowOther}" Margin="0,0,16,4"/>
                        </WrapPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="Select All" Click="SelectAll_Click" Padding="8,4"/>
                            <Button Content="Select None" Click="SelectNone_Click" Padding="8,4"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Column Visibility -->
                <GroupBox Header="Visible Columns">
                    <WrapPanel>
                        <CheckBox Content="Time" IsChecked="{Binding ShowTimeColumn}" Margin="0,0,16,4"/>
                        <CheckBox Content="Elapsed" IsChecked="{Binding ShowElapsedColumn}" Margin="0,0,16,4"/>
                        <CheckBox Content="App" IsChecked="{Binding ShowAppColumn}" Margin="0,0,16,4"/>
                        <CheckBox Content="Session" IsChecked="{Binding ShowSessionColumn}" Margin="0,0,16,4"/>
                        <CheckBox Content="Title" IsChecked="{Binding ShowTitleColumn}" Margin="0,0,16,4"/>
                        <CheckBox Content="Thread" IsChecked="{Binding ShowThreadColumn}" Margin="0,0,16,4"/>
                    </WrapPanel>
                </GroupBox>

                <!-- Info Text -->
                <Border Background="#FFFDE7" BorderBrush="#FFC107" BorderThickness="1"
                        Padding="8" Margin="0,0,0,8" CornerRadius="4">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#x2139;" FontSize="16" Foreground="#F57C00" Margin="0,0,8,0" VerticalAlignment="Top"/>
                        <TextBlock TextWrapping="Wrap" Foreground="#5D4037" FontSize="12">
                            <Run FontWeight="Bold">Tip:</Run> Click tags to quickly select/deselect filters.
                            <LineBreak/>
                            Tags appear automatically as log entries are received.
                            <LineBreak/>
                            You can also type comma-separated values in the text boxes.
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>
